<template>
	<view class="index">
		<view class="title">
			<view>å¥½ä¹…ä¸è§ï¼Œå©šç¤¼è§ä¸¨{{ couple.groom.name }}&{{ couple.bride.name }}</view>
			<view>æˆ‘ä»¬ç»“å©šå•¦~</view>
		</view>

		<view class="desc">
			<text class="author">{{ publisher }}</text>
			<text class="date">{{ weddingTimeStr[0] }}</text>
		</view>

		<view class="cover-wrap">
			<image class="img-cover-word"
				src="https://h5cdn.hunbei.com/editorCustomPic/2023-5-5-XpF8Q3dtRTsbfzTY8WwBwFWpDhiGPe5k?imageMogr2/auto-orient/thumbnail/747x693>"
				mode="aspectFit" />
			<view class="cover">
				<image class="img-invitation"
					src="https://h5cdn.hunbei.com/editorCustomPic/2022-11-4-N87SPKmaSQW7kZ3i7ZH4QHeMXpYhZzDs.png?imageMogr2/auto-orient/crop/!1455x384a457a363/quality/90|imageMogr2/thumbnail/659x174>"
					mode="aspectFit" />
				<image class="img-cover" :src="imgs.cover" mode="aspectFit" />
			</view>
			<view class="lh15">æ–¯äººè‹¥å¦‚è™¹ï¼Œé‡ä¸Šæ–¹çŸ¥æœ‰</view>
		</view>

		<view class="music">
			<view :class="'music-controls ' + (musicIsPaused ? 'paused' : '')" @tap="toggleMusic">
				<image src="../../static/images/icon/music.png" mode="aspectFit" />
			</view>
			<view class="music-left">
				<view class="music-title">{{ music.name }} - {{ music.singer }}</view>
				<view class="music-desc">å·²ä¸ºæ‚¨æ’­æ”¾äº†æ­Œæ›²</view>
			</view>
			<view class="music-right">
				<image class="music-status"
					src="https://h5cdn.hunbei.com/editorCustomPic/2022-5-25-dcdPDnJmTyZs5FbjdeWdXShEEYRkN6A4.gif?imageMogr2/auto-orient/thumbnail/48x34>"
					mode="aspectFit" />
				<image class="music-poster" :src="imgs.poster" mode="aspectFit" />
			</view>
		</view>

		<view class="tc lh21 mb58">
			<view>hi~äº²çˆ±çš„ä½ ~</view>
			<view>å½“æ”¶åˆ°è¿™å°è¯·æŸ¬çš„æ—¶å€™</view>
			<view class="mb58">æˆ‘ä»¬çš„å©šç¤¼å·²ç»åœ¨å€’è®¡æ—¶å•¦</view>
			<view>ä»¥å‰è§‰å¾—å©šç¤¼æ˜¯ä¸€åˆ™å®˜æ–¹å…¬å‘Š</view>
			<view>ç°åœ¨æ‰æ˜ç™½</view>
			<view>è¿™æ˜¯ä¸€åœºä¸ºæ•°ä¸å¤šçš„ç›¸èš</view>
			<view>æ˜¯åƒé‡Œè¿¢è¿¢çš„å¥”èµ´</view>
			<view class="mb58">æ˜¯ä¸è®¡å¾—å¤±çš„æ”¯æŒ</view>
			<view>å¥½ä¹…ä¸è§ï¼Œå©šç¤¼è§</view>
			<view>â¤</view>
		</view>

		<view class="tc lh21 mb58">
			<image class="img-introduce"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-8-22-WNhBXi3ty4fw7dwFBxSZneDKYtz754ya.png?imageMogr2/auto-orient/thumbnail/542.00x58.84>"
				mode="aspectFit" />
		</view>

		<view class="husband lh21 mb58">
			<image class="img-husband" :src="imgs.husband" mode="aspectFit" />
			<view class="husband-desc">
				<view>/</view>
				<view>ä»–æœ‰Â æœ€æš–çš„çœŸå¿ƒ</view>
				<view>ç»†è…»çš„å¿ƒæ€</view>
				<view>æˆ‘ä¸€ç™¾åˆ†çš„ç”·å­©</view>
			</view>
		</view>

		<view class="wife lh21 mb58">
			<view class="wife-desc">
				<view>/</view>
				<view>{{ anniversary }}</view>
				<view>ä¸€è§é’Ÿæƒ…</view>
				<view>æ˜¯çµé­‚è®¤å‡ºäº†ä½ </view>
			</view>
			<image class="img-wife" :src="imgs.wife" mode="aspectFit" />
		</view>

		<view class="tc lh21 mb58">
			<view>æˆ‘å¸¸å¸¸è§‰å¾—ä¹Ÿè®¸è¿™è¾ˆå­</view>
			<view>ä¸ä¼šå¾—åˆ°æ‰€è°“çš„çˆ±æƒ…äº†</view>
			<view>ç›´åˆ°</view>
			<view>ä½ å‡ºç°äº†</view>
		</view>

		<view class="tc lh21 mb58">
			<image class="img-separate mb58"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-1-26-rx4ZZi3KdMErdNk4E2X3EHh3EiB3bPdY.gif?imageMogr2/auto-orient/thumbnail/864x27>"
				mode="aspectFit" />
			<image class="img-wedding mb58"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-8-22-HsinmKrKbjrjeSYWDBi7JYMjxrNeeXtj.png?imageMogr2/auto-orient/thumbnail/507x99>/format/webp"
				mode="aspectFit" />
			<swiper class="swiper-western mb58" autoplay circular interval="2500" easing-function="linear"
				indicator-dots>
				<swiper-item v-for="(item, index) in imgs.swiper1" :key="index">
					<image class="img-full-width" :src="item" mode="widthFix" />
				</swiper-item>
			</swiper>
			<view>äººä»¬ä»è¯—äººçš„å­—å¥é‡Œï¼Œ</view>
			<view>é€‰å–è‡ªå·±å¿ƒçˆ±çš„æ„ä¹‰ã€‚</view>
			<view>ä½†è¯—å¥çš„æœ€ç»ˆæ„ä¹‰æ˜¯æŒ‡å‘ä½ ã€‚</view>
			<view>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â â€”â€”æ³°æˆˆå°”ã€Šå‰æª€è¿¦åˆ©ã€‹</view>
		</view>

		<view class="tc lh21 mb100">
			<view class="img-list mb58">
				<image class="img-full-width" :src="item" mode="widthFix" v-for="(item, index) in imgs.series"
					:key="index"></image>
			</view>
			<view>äººç”Ÿå…¶å®åªè¦ä¸¤æ¬¡å¹¸è¿å°±å¥½</view>
			<view>ä¸€æ¬¡é‡è§ä½ ï¼Œä¸€æ¬¡æ˜¯èµ°åˆ°åº•</view>
			<view>å¦‚ä»Šï¼Œæˆ‘ä»¬å†³å®šå¼€å¯äººç”Ÿæ–°çš„ç¯‡ç« </view>
			<view>è®©çˆ±ä»¥å¤«å¦»ä¹‹åå»¶ç»­</view>
		</view>

		<view class="leaf lh21 mb100">
			<view class="img-row mb28">
				<image class="img-leaf-left" :src="imgs.leftUp" mode="aspectFit" />
				<image class="img-leaf"
					src="https://h5cdn.hunbei.com/editorCustomPic/2022-8-2-k8yzidKa4XYnCZdMDQWfGmaxzXreeAeP.png?imageMogr2/auto-orient/thumbnail/624x493>/format/webp"
					mode="aspectFit" />
			</view>
			<view class="img-row tc pr40">
				<image class="img-leaf-left-down" :src="imgs.leftDown" mode="aspectFit" />
				<view class="text">
					<view class="line"></view>
					<view>å§‹äºåˆè§ï¼Œ</view>
					<view>æ­¢äºç»ˆè€ã€‚</view>
				</view>
			</view>
		</view>

		<view class="tc lh21 mb100">
			<view class="img-map mb100">
				<view class="img-map-row">
					<image class="img-map-item" :src="imgs.map[0]" mode="aspectFit" />
					<image class="img-map-item" :src="imgs.map[1]" mode="aspectFit" />
				</view>
				<view class="img-map-row">
					<image class="img-map-item" :src="imgs.map[2]" mode="aspectFit" />
					<image class="img-map-item" :src="imgs.map[3]" mode="aspectFit" />
				</view>
			</view>
			<view>ä¸ç®¡å¤–é¢çš„ä¸–ç•Œé£é›¨é£˜æ‘‡ä¹Ÿç½¢</view>
			<view>å¸Œæœ›æˆ‘ä»¬æ€»èƒ½ä»¥æœ€ç®€å•çš„æ–¹å¼ç›¸ä¼´</view>
			<view>å®¶äººé—²åï¼Œç¯ç«å¯äº²</view>
			<view>ä¸–ä¸Šæœ€æœ‰è¶£çš„äº‹</view>
			<view>å°±æ˜¯å’Œæœ€çˆ±çš„äººä¸€èµ·è™šåº¦å…‰é˜´</view>
		</view>

		<view class="tc lh21 mb58">
			<swiper class="swiper-outdoor" autoplay circular interval="2500" easing-function="linear" indicator-dots>
				<swiper-item v-for="(item, index) in imgs.swiper2" :key="index">
					<image class="img-full-width" :src="item" mode="widthFix" />
				</swiper-item>
			</swiper>

			<image class="img-swiper-float" :src="imgs.swiper2Static" mode="aspectFit" />
			<view>æˆ‘ä»¬å°†æˆä¸ºå½¼æ­¤ç´§ç´§ä¾é çš„å®¶äºº</view>
			<view>é“¶æ²³ç³»æµªæ¼«çš„æ­è½¦å®¢</view>
			<view>å…±åŒå»æ¢ç´¢å¹¿é˜”é¥è¿œçš„ä¸–ç•Œ</view>
		</view>

		<view class="tc lh21 mb58">
			<image class="img-separate mb58"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-1-26-rx4ZZi3KdMErdNk4E2X3EHh3EiB3bPdY.gif?imageMogr2/auto-orient/thumbnail/864x27>"
				mode="aspectFit" />
			<image class="img-you mb58"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-8-22-PZQCrTaWTKSdJKe2Gd5FzatfyQWzZyjA.png?imageMogr2/auto-orient/thumbnail/603x118>/format/webp"
				mode="aspectFit" />
			<view>äººçš„ä¸€ç”Ÿæœ‰ä¸‰ä¸‡å¤šå¤©</view>
			<view>å¾ˆå¼€å¿ƒè¿™ä¸€å¤©</view>
			<view>ä½ ä¸“ä¸ºæˆ‘ä»¬è€Œæ¥</view>
			<view>è¯·å‡†å¤‡å¥½ä½ çš„å¥½å¿ƒæƒ…å’Œå¥½èƒƒå£</view>
			<view>æ¥å¥”èµ´è¿™åœº{{ weddingTimeStr[1] }}æ—¥çš„èšä¼šå­~</view>
		</view>

		<view class="tc lh21 mb58">
			<view class="love mb58">å›</view>
			<!-- 			<swiper class="swiper-chinese mb58" autoplay circular interval="2500" easing-function="linear"
				indicator-dots>
				<swiper-item v-for="(item, index) in imgs.swiper3" :key="index">
					<image class="img-full-width" :src="item" mode="widthFix" />
				</swiper-item>
			</swiper> -->
			<view class="mb58">{{ couple.groom.name }} & {{ couple.bride.name }}</view>
			<view>æºåŒæˆ‘ä»¬çš„çˆ¶æ¯</view>
			<view>é‚€è¯·æ‚¨å‡ºå¸­æˆ‘ä»¬çš„å©šç¤¼ä»ªå¼</view>
			<view>è§è¯å’Œåˆ†äº«æˆ‘ä»¬çš„å¹¸ç¦æ—¶åˆ»</view>
		</view>

		<image class="img-separate mb58"
			src="https://h5cdn.hunbei.com/editorCustomPic/2022-1-26-rx4ZZi3KdMErdNk4E2X3EHh3EiB3bPdY.gif?imageMogr2/auto-orient/thumbnail/864x27>"
			mode="aspectFit" />
		<image class="img-calendar-title mb58"
			src="https://h5cdn.hunbei.com/editorCustomPic/2022-8-22-wybCS45p5fFnRhTpQB5x48WhY4bjEDj8.png?imageMogr2/auto-orient/thumbnail/511x117>/format/webp"
			mode="aspectFit" />

		<view class="countdown">
			<view class="countdown-item" v-for="(item, index) in countdown" :key="index">
				<view class="number animate__animated" :class="item.animate" :key="item.value.value">{{ item.value
				}}
				</view>
				<text class="label">{{ item.label }}</text>
			</view>
		</view>
		<view class="tc lh21 mb58">
			<calendar id="calendar" :date="weddingTimeStr[0]"></calendar>
			<view>{{ weddingTimeStr[2] }}</view>
			<view>{{ weddingTimeStr[3] }}</view>
		</view>

		<view class="location mb58">
			<view>
				<view>{{ location.name }}</view>
				<view>{{ location.address }}</view>
			</view>
			<map :longitude="location.longitude" :latitude="location.latitude" :enable-zoom="false"
				:enable-scroll="false" :markers="location.markers" />
			<view class="location-mask" @tap="openLocation"></view>
		</view>

		<!-- <button form-type="submit" open-type="getUserInfo" @tap="goPresent">æˆ‘è¦å‡ºå¸­</button> -->

		<view class="tc lh21 mb58">
			<image class="img-separate mb58"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-1-26-rx4ZZi3KdMErdNk4E2X3EHh3EiB3bPdY.gif?imageMogr2/auto-orient/thumbnail/864x27>"
				mode="aspectFit" />
			<image class="img-full-width mb58" :src="imgs.end1" mode="widthFix" />
			<view class="tl">
				<view class="tips">æ¸©é¦¨tipsï¼š</view>
				<view>è¯·é¢„ç•™å¥½{{ weddingTimeStr[4] }}è¿™ä¸€å¤©çš„è¡Œç¨‹</view>
				<view>å¦‚æœè¢«äº‹åŠ¡ç‰µç»Šæˆ–ä¸´æ—¶æœ‰å˜åŒ–</view>
				<view class="mb58">è¯·æå‰å‘ŠçŸ¥æ–°éƒ/æ–°å¨˜</view>
				<view>è®¸ä¹…æœªè§Â ï¼Œç”šæ˜¯æƒ³å¿µ</view>
				<view>æˆ‘ä»¬ï¼Œå©šç¤¼è§</view>
			</view>
		</view>

		<view class="tc lh21 mb100">
			<image class="img-end"
				src="https://h5cdn.hunbei.com/editorCustomPic/2022-8-19-niYXMwfBrA5bCeRQSFnXRRKRmcSnmfEC.png?imageMogr2/auto-orient/thumbnail/519x264>/format/webp"
				mode="aspectFit" />
		</view>

		<!-- å½©è›‹æ¿å—è§†ä¹ä¸ªäººæƒ…å†µå†³å®šè¦ä¸è¦ -->
		<view v-if="showEggs" class="egg tc">
			<view class="egg-title">
				å½©è›‹
				<image src="/static/images/icon/egg.png" mode="aspectFit" />
			</view>
			<view class="mb28">
				æ­¤å°ç¨‹åºç”±æ–°éƒå“¥æœ¬äººç‹¬ç«‹å®Œæˆå¼€å‘ğŸ˜œï¼Œå¦‚æœæœ‰ bug çš„è¯æ•¬è¯·è°…è§£ï¼Œå¦‚æœèƒ½åé¦ˆç»™æˆ‘çš„è¯å°±æ›´å¥½äº†ğŸ˜
			</view>

			<view class="mb28">
				å°ç¨‹åºå‰ç«¯ä»£ç ä»¥å¼€æºï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ä¸Š github è‡ªå–ï¼šhttps://github.com/ymstar/happy-wedding
			</view>

			<view class="mb28">æœ€åæ”¾ä¸Šæˆ‘ä»¬çš„ä¸‰ç”Ÿä¸‰ä¸–è§†é¢‘âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿â˜ºï¸</view>

			<view v-if="magic" class="mb58">
				<channel finder-user-name="sphnQSkTBRwbRTK"
					feed-id="export/UzFfAgtgekIEAQAAAAAAwXcqT9uO3AAAAAstQy6ubaLX4KHWvLEZgBPElaBoJkt9KpyIzNPgMJoaUAjdYlpRj52z8YxKBNxQ"
					poster="https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%A7%86%E9%A2%91%E5%B0%81%E9%9D%A2.jpg"
					nickname="æ¨æ˜"></channel>
			</view>

			<view class="mb28">å¥½å•¦ï¼Œç‹—ç²®æ’’åˆ°è¿™é‡Œå°±å·®ä¸å¤šå•¦ï¼Œæˆ‘ä»¬å©šç¤¼ä¸Šè§å“¦~ğŸ’’ğŸ‘«ğŸ»</view>
			<view>æœªå®Œï¼Œå¾…ç»­</view>
			<view>çˆ±ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨è·¯ä¸Š</view>
		</view>


		<view v-if="magic" class="greetings">
			<view class="greetings-list">
				<view :class="'greetings-item ' + (activeIdx === index ? 'active' : '')" @animationend="onAnimationend"
					v-for="(item, index) in greetings" :key="index">
					<text class="greetings-name">{{ item.visitor.name }}ï¼š</text>

					{{ item.message || 'æ–°å©šå¿«ä¹' }}
				</view>
			</view>
			<view class="controller">
				<view class="controller-btn">
					<image @tap="goPhone" src="/static/images/icon/phone.png" mode="widthFix" />
				</view>
				<view class="controller-btn">
					<image @tap="goGreet" src="/static/images/icon/write.png" mode="widthFix" />
				</view>
				<view class="controller-btn">
					<image @tap="openLocation" src="/static/images/icon/go.png" mode="widthFix" />
				</view>
			</view>
		</view>
	</view>
</template>

<script lang="ts" setup>
import { onLoad, onReady, onShareAppMessage, onShareTimeline, onShow, onUnload } from '@dcloudio/uni-app';
import { getAllMessageList, getCommonConfig } from '@src/api/happy-wedding';
import calendar from '@src/component/calendar/calendar.vue';
import channel from '@src/component/channel/channel.vue';
import { GlobalData } from '@src/types';
import { showToast } from '@src/utils';
import { computed, getCurrentInstance, inject, onMounted, reactive, ref } from 'vue';

const instance = getCurrentInstance()
const globalData: GlobalData = instance.appContext.config.globalProperties.globalData

const openId = globalData.mpUserInfo.openId

const adminsIds = ref([])
const isAdmin = computed(() => {
	return adminsIds.value.indexOf(openId) !== -1
})

const musicIsPaused = false;
const activeIdx = ref(0);

const weddingTimeStr = [
	'2025-10-02 11:30',
	'ç§‹',
	'2025 å¹´ 10 æœˆ 2å·Â Â 11:30',
	'å†œå†å…«æœˆåä¸€',
	' 10 æœˆ 2 å· '
]
const showEggs = true;
const greetings = ref([])

const innerAudioContext = globalData.innerAudioContext
const music = ref({
	src: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/music/%E4%BD%A0%E6%98%AF%E5%AF%B9%E7%9A%84%E4%BA%BA.flac',
	name: 'ä½ æ˜¯å¯¹çš„äºº',
	singer: 'æˆšè–‡&ä¿Šæ˜Š'
})
const isPlaying = ref(false)
const location = {
	name: 'ç»´è‰¾OLå©šå®´è‰ºæœ¯ä¸­å¿ƒ',
	address: 'æ²³åŒ—çœå¼ å®¶å£å¸‚å¼ åŒ—å¿æ°¸æ˜¥å—å¤§è¡—88å·',
	longitude: 114.72214179003208,
	latitude: 41.1343623956274,
	markers: [{
		iconPath: '../../static/images/nav.png',
		id: 1,
		width: 50,
		height: 50,
		longitude: 114.72214179003208,
		latitude: 41.1343623956274
	}]
}
const publisher = 'æ¨æ²™ç»„åˆ'
const anniversary = '2021.06.12'

const couple = {
	groom: {
		name: '',
		phone: ''
	},
	bride: {
		name: '',
		phone: ''
	}
}

const magic = ref(true);

const imgs = {
	// å°é¢å›¾
	cover: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/other/%E5%B0%81%E9%9D%A2%E5%9B%BE1.jpg',
	// éŸ³ä¹å°é¢
	poster: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E9%9F%B3%E4%B9%90%E5%B0%81%E9%9D%A2.jpg',
	// æ–°éƒç‹¬ç…§
	husband: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E6%96%B0%E9%83%8E%E7%8B%AC%E7%85%A7.jpg',
	// æ–°å¨˜ç‹¬ç…§
	wife: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E6%96%B0%E5%A8%98%E7%8B%AC%E7%85%A7.jpg',
	// è½®æ’­å›¾1
	swiper1: [
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BD%AE%E6%92%AD%E5%9B%BE%201-1.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BD%AE%E6%92%AD%E5%9B%BE%201-2.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BD%AE%E6%92%AD%E5%9B%BE1-3.jpg'
	],
	// è¿ç»­å›¾
	series: [
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BF%9E%E7%BB%AD%E5%9B%BE%201.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BF%9E%E7%BB%AD%E5%9B%BE%202.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BF%9E%E7%BB%AD%E5%9B%BE%203.jpg'
	],
	// å·¦ä¸Šå›¾
	leftUp: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E5%B7%A6%E4%B8%8A%E5%9B%BE.jpg',
	// å·¦ä¸‹å›¾
	leftDown: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/9Z7A1035.jpg',
	// å››å®«å›¾
	map: [
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E5%9B%9B%E5%AE%AB%E6%A0%BC%201.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E5%9B%9B%E5%AE%AB%E6%A0%BC%202.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E5%9B%9B%E5%AE%AB%E6%A0%BC%204.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E5%9B%9B%E5%AE%AB%E6%A0%BC%203.jpg'
	],
	// è½®æ’­å›¾2
	swiper2: [
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BD%AE%E6%92%AD%E5%9B%BE%202-1.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BD%AE%E6%92%AD%E5%9B%BE%202-2.jpg',
		'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E8%BD%AE%E6%92%AD%E5%9B%BE%202-3.jpg'
	],
	// è½®æ’­å›¾2ä¸‹æ–¹å¸¸é©»å›¾
	swiper2Static: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/9Z7A0687.jpg',
	// è½®æ’­å›¾3
	swiper3: [
		'https://res.wx.qq.com/t/fed_upload/77b990f0-6f16-4fa2-8163-ad0eac3e40da/swiper3-1.jpg',
		'https://res.wx.qq.com/t/fed_upload/77b990f0-6f16-4fa2-8163-ad0eac3e40da/swiper3-2.jpg',
		'https://res.wx.qq.com/t/fed_upload/77b990f0-6f16-4fa2-8163-ad0eac3e40da/swiper3-3.jpg'
	],
	// ç»“å°¾å›¾1
	end1: 'https://happy-wedding.sym930302.xyz/public/happy-wedding/yangming/image/%E7%BB%93%E5%B0%BE%E5%9B%BE.jpg',
	// ç»“å°¾å›¾2
	end2: 'https://res.wx.qq.com/t/fed_upload/9b5bad9c-216b-4fd5-a3da-01bdb3a5e832/end2.jpg'
}
const timer = ref(null);

const weddingDate = new Date(weddingTimeStr[0]).getTime();
const days = computed(() => {
	const diff = weddingDate - now.value;
	return Math.floor(diff / (1000 * 60 * 60 * 24));
});
const hours = computed(() => {
	const diff = weddingDate - now.value;
	return Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
})
const minutes = computed(() => {
	const diff = weddingDate - now.value;
	return Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
})
const seconds = computed(() => {
	const diff = weddingDate - now.value;
	return Math.floor((diff % (1000 * 60)) / 1000);
})

const now = ref(Date.now());

const countdown = computed(() => {
	// è®¡ç®—å¤©æ•°ã€å°æ—¶ã€åˆ†é’Ÿã€ç§’
	return [
		{ value: days, label: 'å¤©', animate: 'bounce' },
		{ value: hours, label: 'æ—¶', animate: 'bounce' },
		{ value: minutes, label: 'åˆ†', animate: 'bounce' },
		{ value: seconds, label: 'ç§’', animate: 'bounce' }
	];
});

const getMessageList = () => {
	getAllMessageList().then(res => {
		greetings.value = res.data
	})
}

onMounted(() => {
	magic.value = globalData.magic;
	getCommonConfig().then(res => {
		adminsIds.value = res.data.adminOpenIds
		couple.groom = res.data.groom
		couple.bride = res.data.bride
	})
	setInterval(() => now.value = Date.now(), 1000)
})
onLoad(() => {
	timer.value = null;
	getMessageList();
	setInterval(() => getMessageList(), 20000)
	innerAudioContext.onEnded(onEnded)
	innerAudioContext.onPlay(onPlay)
	innerAudioContext.onPause(onPause)
	innerAudioContext.src = music.value.src
	innerAudioContext.loop = true
})

onShow(()=>{
	innerAudioContext.play()
})

const onPlay = () => {
	isPlaying.value = true
}
const onPause = () => {
	isPlaying.value = false
}
const onEnded = () => {
	if (globalData.musicIndex >= globalData.musicList.length) {
		globalData.musicIndex = 0
	}
	globalData.innerAudioContext.src = globalData.musicList[globalData.musicIndex].url
	globalData.musicIndex += 1
}

// å°ç¨‹åºå¸è½½æ—¶ï¼Œå–æ¶ˆè‡ªåŠ¨æ‹‰å–ç¥ç¦è¯­å®šæ—¶å™¨ï¼Œé”€æ¯èƒŒæ™¯éŸ³ä¹
onUnload(() => {
	if (timer.value !== null) {
		clearInterval(timer.value);
		timer.value = null;
	}
})


// åˆ†äº«åˆ°ä¼šè¯
onShareAppMessage(() => {
	return {
		title: 'å¥½ä¹…ä¸è§ï¼Œå©šç¤¼è§Ù©(à¹‘^o^à¹‘)Û¶',
		imageUrl: '../../static/images/shareAppMsg.jpg'
	};
})

// åˆ†äº«åˆ°æœ‹å‹åœˆ
onShareTimeline(() => {
	return {
		title: 'å¥½ä¹…ä¸è§ï¼Œå©šç¤¼è§Ù©(à¹‘^o^à¹‘)Û¶',
		imageUrl: '../../static/images/shareTimeline.jpg'
	};
})

const toggleMusic = () => {
	if (innerAudioContext.paused) {
		innerAudioContext.play()
		showToast('èƒŒæ™¯éŸ³ä¹å·²å¼€å¯~')
	} else {
		innerAudioContext.pause()
		showToast('æ‚¨å·²æš‚åœéŸ³ä¹æ’­æ”¾~')
	}
}
const openLocation = () => {
	wx.openLocation({
		latitude: Number(location.latitude),
		longitude: Number(location.longitude),
		scale: 18
	})
}

// è½®æ’­åŠ¨ç”»ç»“æŸæ—¶åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª
const onAnimationend = () => {
	activeIdx.value = activeIdx.value === greetings.value.length - 1 ? 0 : activeIdx.value + 1;
}

// è·³è½¬åˆ°è”ç³»æ–°éƒæ–°å¨˜æ¿å—
const goPhone = () => {
	uni.switchTab({
		url: '../map/index'
	})
}

// è·³è½¬åˆ°å†™è¡¨å•æ¿å—
const goGreet = () => {
	uni.switchTab({
		url: '../greet/index'
	})
}

</script>
<style lang="scss" scoped>
@import '../../common/base.css';
@import '../../common/animation.css';

.index {
	height: 100%;
	// width: 100%;
	position: relative;
	margin-left: 5%;
	margin-right: 5%;
}

.title {
	font-size: 36rpx;
	margin-bottom: 28rpx;
	letter-spacing: 4rpx;
	line-height: 1.5;
}

.desc {
	font-size: 28rpx;
	margin-bottom: 44rpx;
}

.author {
	color: rgb(91, 106, 145);
	margin-right: 20rpx;
}

.date {
	color: rgb(178, 178, 178);
}

.cover-wrap {
	position: relative;
	display: flex;
	flex-direction: column;
	align-items: flex-end;
}

.img-cover-word {
	position: absolute;
	left: 20rpx;
	bottom: 0;
	width: 498rpx;
	height: 462rpx;
	z-index: 999;
}

.cover {
	display: flex;
	flex-direction: column;
	margin-bottom: 186rpx;
}

.img-invitation {
	width: 436rpx;
	height: 116rpx;
	margin-bottom: 16rpx;
}

.img-cover {
	width: 454rpx;
	height: 652rpx;
}

.music {
	display: flex;
	align-items: center;
	margin: 60rpx 40rpx 88rpx;
	padding: 20rpx;
	box-shadow: rgb(194, 194, 194) 0 0 10rpx;
	border-radius: 10rpx;
}

.music-controls {
	position: fixed;
	z-index: 99999999;
	top: 20rpx;
	right: 20rpx;
	background-color: rgba(165, 165, 165, 0.2);
	border-radius: 50%;
	border: 4rpx solid white;
	width: 56rpx;
	height: 56rpx;
	display: flex;
	justify-content: center;
	align-items: center;
	-webkit-animation: mrotate 5s linear infinite;
	animation: mrotate 5s linear infinite;
	overflow: hidden;
}

.music-controls.paused {
	-webkit-animation: none;
	animation: none;
}

.music-controls.paused::after {
	content: '';
	width: 56rpx;
	height: 0;
	position: absolute;
	top: 26rpx;
	left: 0;
	border-top: 4rpx solid white;
	-webkit-transform: rotate(45deg);
	transform: rotate(45deg);
}

.music-controls image {
	width: 40rpx;
	height: 40rpx;
}

.music-left {
	display: flex;
	flex-direction: column;
	flex: 1;
}

.music-title {
	font-size: 28rpx;
	line-height: 1;
	font-weight: bold;
	padding: 12rpx 10rpx;
}

.music-desc {
	font-size: 24rpx;
	line-height: 1;
	font-weight: normal;
	opacity: 0.5;
	padding: 12rpx 10rpx;
}

.music-right {
	height: 116rpx;
	display: flex;
	gap: 12rpx;
	align-items: flex-end;
}

.music-status {
	width: 32rpx;
	height: 22rpx;
}

.music-poster {
	width: 116rpx;
	height: 116rpx;
}

.img-introduce {
	width: 677rpx;
	height: 60rpx;
}

.moon {
	position: relative;
	display: flex;
	gap: 20rpx;
	justify-content: center;
	margin: 60rpx 0 88rpx 0;
}

.img-moon {
	width: 310rpx;
	height: 460rpx;
}

.birthday {
	position: absolute;
	display: flex;
	gap: 20rpx;
	justify-content: center;
	bottom: 28rpx;
	color: white;
	font-size: 32rpx;
}

.birthday text {
	width: 310rpx;
}

.husband,
.wife {
	display: flex;
}

.img-husband,
.img-wife {
	width: 390rpx;
	height: 308rpx;
}

.husband-desc,
.wife-desc {
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	padding: 0 24rpx 24rpx;
	width: 390rpx;
	box-sizing: border-box;
}

.wife-desc {
	text-align: right;
}

.img-wedding {
	width: 100%;
	height: 66rpx;
}

.swiper-western {
	height: 986rpx;
}

.img-list {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 14rpx;
}

.leaf {
	padding-right: 0;
}

.img-row {
	display: flex;
	position: relative;
	align-items: flex-end;
	overflow: hidden;
}

.img-row .text {
	width: 240rpx;
	box-sizing: border-box;
	padding-right: 20rpx;
	padding-bottom: 24rpx;
	text-align: right;
	position: relative;
}

.img-leaf-left {
	width: 448rpx;
	height: 600rpx;
}

.img-leaf {
	width: 416rpx;
	height: 328rpx;
	transform: rotate(162deg);
	opacity: 0.3;
	position: absolute;
	top: 80rpx;
	right: -120rpx;
}

.img-leaf-left-down {
	width: 358rpx;
	height: 232rpx;
}

.line {
	border-top: 2rpx solid black;
	width: 114rpx;
	-webkit-transform: rotate(333deg);
	transform: rotate(333deg);
	position: absolute;
	top: -60rpx;
	left: 62rpx;
}

.img-map {
	display: flex;
	flex-direction: column;
	gap: 12rpx;
}

.img-map-row {
	display: flex;
	gap: 12rpx;
}

.img-map-item {
	width: 384rpx;
	height: 444rpx;
}

.swiper-outdoor {
	height: 452rpx;
}

.img-swiper-float {
	box-sizing: content-box;
	width: 418rpx;
	height: 280rpx;
	border: 10rpx solid white;
	position: relative;
	top: -80rpx;
}

.img-you {
	width: 100%;
	height: 78rpx;
}

.love {
	font-family: å¾®è½¯é›…é»‘;
	font-size: 196rpx;
	line-height: 1;
	font-weight: bold;
	writing-mode: lr-tb;
	color: rgb(133, 22, 14);
}

.swiper-chinese {
	height: 910rpx;
}

.img-calendar-title {
	width: 100%;
	height: 78rpx;
}

.location {
	border-radius: 20rpx;
	box-shadow: rgb(153, 153, 153) 0 0 10rpx;
	padding: 20rpx;
	margin-left: 40rpx;
	margin-right: 40rpx;
	line-height: 1.5;
	font-size: 24rpx;
	position: relative;
}

.location>view {
	padding: 10rpx;
}

.location-mask {
	position: absolute;
	width: 100%;
	height: 260rpx;
	top: 122rpx;
	left: -10rpx;
}

.phone {
	display: flex;
	justify-content: center;
}

.phone-item {
	display: flex;
	flex-direction: column;
	align-items: center;
	width: 50%;
}

.phone button {
	background-color: rgba(133, 22, 14, 0.9);
	border-radius: 20rpx;
	font-size: 24rpx;
	color: white;
	width: 196rpx !important;
	height: 56rpx;
	line-height: 1;
	font-weight: normal;
	margin-top: -30rpx;
	padding: 16rpx 0;
	display: flex;
	justify-content: center;
	align-items: center;
	gap: 8rpx;
}

.phone button:active {
	background-color: rgba(133, 22, 14, 1);
}

.phone button image {
	width: 32rpx;
	height: 32rpx;
}

.form {
	padding: 0 40rpx;
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 40rpx;
}

.form view {
	position: relative;
}

.form text {
	position: absolute;
	top: 4rpx;
	left: 16rpx;
	color: #ed5566;
	line-height: 64rpx;
}

.form input {
	box-sizing: border-box;
	width: 448rpx;
	height: 64rpx;
	line-height: 64rpx;
	background-color: white;
	border-radius: 28rpx;
	border: 2rpx solid rgb(153, 153, 153);
	text-align: left;
	padding: 0 40rpx !important;
	font-size: 24rpx;
	font-weight: normal;
	color: black;
}

.form textarea {
	box-sizing: border-box;
	width: 448rpx;
	background-color: white;
	border-radius: 28rpx;
	border: 2rpx solid rgb(153, 153, 153);
	text-align: left;
	padding: 20rpx 40rpx !important;
	font-size: 24rpx;
	font-weight: normal;
	color: black;
}

.form-input-placeholder {
	font-size: 24rpx;
	font-weight: normal;
	color: rgb(110, 110, 110);
}

.form button {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 448rpx !important;
	height: 64rpx;
	background-color: rgba(133, 22, 14, 0.9);
	border-radius: 28rpx;
	line-height: 1;
	color: white;
	font-size: 28rpx;
	font-weight: normal;
	text-align: center;
}

.form button:active {
	background-color: rgba(133, 22, 14, 1);
}

.tips {
	font-size: 32rpx;
	line-height: 1;
	padding: 10rpx;
	background-color: #999999;
	display: inline-block;
	margin-bottom: 40rpx;
}

.img-end {
	width: 100%;
	height: 176rpx;
}

.egg {
	line-height: 1.6;
	color: rgb(134, 134, 134);
	font-size: 22rpx;
	margin-bottom: 180rpx;
}

.egg-title {
	font-size: 32rpx;
	position: relative;
	display: inline-block;
	margin: 0 auto 28rpx;
	display: flex;
	justify-content: center;
	align-items: center;
	width: fit-content;
}

.egg-title::before,
.egg-title::after {
	position: absolute;
	top: 50%;
	left: -20rpx;
	transform: translate3D(-100%, -50%, 0);
	content: '';
	width: 80rpx;
	border-top: 2rpx dashed rgb(134, 134, 134);
}

.egg-title::after {
	left: 100%;
	transform: translate3D(20rpx, -50%, 0);
}

.egg-title image {
	width: 40rpx;
	height: 40rpx;
}

.greetings {
	position: fixed;
	bottom: 60rpx;
	padding: 0 40rpx;
	display: flex;
	align-items: flex-end;
	width: 100%;
	box-sizing: border-box;
}

.greetings-list {
	display: flex;
	flex-direction: column;
	gap: 16rpx;
	pointer-events: none;
	width: 66%;
	position: relative;
}

.greetings-item {
	padding: 14rpx 20rpx;
	color: white;
	background: linear-gradient(90deg, rgba(133, 22, 14, 0.8) 0%, rgba(133, 22, 14, 0.5) 100%);
	border-radius: 10rpx;
	width: fit-content;
	word-wrap: break-word;
	word-break: break-all;
	position: absolute;
	left: 0;
	bottom: 0;
	transform: translateX(calc(-100% - 40rpx));
}

.greetings-item.active {
	-webkit-animation: fadeInOutLeft 5s linear;
	animation: fadeInOutLeft 5s linear;
}

.greetings-name {
	font-weight: 600;
}

.controller {
	display: flex;
	gap: 16rpx;
	margin-left: auto;
	margin-bottom: 2rpx;
}

.controller-btn {
	width: 60rpx;
	height: 60rpx;
	background-color: rgba(133, 22, 14, 1);
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	opacity: 0.7;
}

.controller-btn:active {
	opacity: 1;
}

.controller image {
	width: 40rpx;
}

.manager {
	position: fixed;
	top: 50%;
	left: 20rpx;
	padding: 0;
	transform: translateY(-50%);
	z-index: 99999999;
}

.manager image {
	width: 120rpx;
	height: 120rpx;
}

.countdown {
	display: flex;
	justify-content: center;
	margin: 20px 0;
}

.countdown-item {
	border-color: rgb(153, 153, 153);
	border-radius: 5px;
	border-style: solid;
	border-width: 0px;
	text-align: center;
	background-color: rgb(174, 62, 52);
	min-width: 50px;
	height: auto;
	margin: 5px;
	padding: 5px 0 5px;
	// width: 80px;
}

.number {
	font-size: 18px;
	font-weight: bold;
	color: rgb(255, 255, 255);
	// margin-bottom: 5px;
	animation: bounce 0.5s;
	transition: all 0.3s;
}

.label {
	font-size: 12px;
	color: rgb(255, 255, 255);
}
</style>
